{% include 'publicheader.html' %}

<h1 align="center">Login</h1>

<form method="post" id="login_via_keystroke">

<table>
	<tr>
		<td>Username</td>
		<td><input type="text" name="username"></td>
	</tr>

	<tr align="center">
		<td colspan="2">Please repeat the below paragraph</td>
	</tr>
	<tr align="center">
		<td colspan="2" ><textarea style="width:500px; height:100px">Hunt and peck (two-fingered typing), also known as Eagle Finger</textarea></td>

	</tr>
	<tr align="center">
		<td colspan="2">
			<textarea style="width:500px; height:100px" name="feature_text"  class="form-control"></textarea>
		</td>
	</tr>
	<tr>
		<td colspan="2">
			<input type="button" name="login" class="btn btn-primary" value="Login">
		</td>
	</tr>
</table>
</form>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
<script>


		$(document).ready(function(){

			key_timing = []

			enable = true
			alert("sdfgh")
			$("#login_via_keystroke input[type='button']").click(function(){
				features = []
					
				if (key_timing.length > 1){
					feature = []
					j = 0
					alert(key_timing.length)
					for(i=0;i<key_timing.length-1;i++){
						// feature.push(key_timing[i][0])
						// feature.push(key_timing[i+1][0])
						feature.push(key_timing[i][1]-key_timing[i][0])
						feature.push(key_timing[i+1][1]-key_timing[i+1][0])
						feature.push(key_timing[i+1][0]-key_timing[i][0])
						feature.push(key_timing[i+1][1]-key_timing[i][1])
						feature.push(key_timing[i+1][1]-key_timing[i][0])
						feature.push(key_timing[i+1][0]-key_timing[i][1])
						j++;
						if(j==1){

							console.log(feature)
							features.push(feature)

							feature = []
							j = 0
						}
					}
					
				}
				// console.log(features)
				obj = $('#login_via_keystroke').serializeArray()
				console.log(JSON.stringify(features))
				obj.push({name:$(this).attr('name'),value:$(this).val()})
				obj.push({name:'features',value:JSON.stringify(features)})
				$.post('/login_action/',obj,function(data){
					// console.log(data);
					obj = JSON.parse(data)
					if(obj['status'] == 'success'){
						if(obj['data'].length > 0){
							if(obj['data'][0].usertype == 'user'){
								alert("Entering To Validating your ID card")
								window.location = '/validatingidcard'
								// alert("ok")
							}
						}
					}else{
						alert(obj['reason'])
					}
				});
				key_timing = []
				features = []
			})

			key_info = []

			$("#login_via_keystroke textarea[name='feature_text']").keydown(function(e){
				// console.log(key_info.length)
				if (key_info.length == 0){
					key_info.push(Date.now())
				}
			});	
			$("#login_via_keystroke textarea[name='feature_text']").keyup(function(e){
				// console.log(key_info.length)
				if (key_info.length == 1){
					key_info.push(Date.now())
					key_timing.push(key_info)
					key_info = []
				}
			});


		})

	</script>

{% include 'footer.html' %}